@if (isOpen()) {
  <div 
    class="modal-overlay" 
    (click)="onOverlayClick($event)"
    role="dialog"
    aria-modal="true"
    [attr.aria-labelledby]="'modal-title'">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal__header" [class]="'modal__header--' + resultType()">
        <div class="modal__icon-wrapper">
          @if (resultType() === 'approved') {
            <svg class="modal__icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M22 11.08V12a10 10 0 11-5.93-9.14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <polyline points="22,4 12,14.01 9,11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          } @else {
            <svg class="modal__icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
              <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          }
        </div>
        <h2 id="modal-title" class="modal__title">
          @if (resultType() === 'approved') {
            Comprobante Válido
          } @else {
            Comprobante Inválido
          }
        </h2>
        <p class="modal__subtitle">
          @if (resultType() === 'approved') {
            El comprobante ha sido verificado correctamente en ARCA.
          } @else {
            El comprobante no pudo ser validado en ARCA.
          }
        </p>
        <button 
          class="modal__close" 
          (click)="closeModal.emit()"
          aria-label="Cerrar modal">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
      
      <div class="modal__body">
        <h3 class="modal__section-title">Información del Comprobante</h3>
        
        @if (response()) {
          <div class="modal__grid">
            <div class="modal__field">
              <span class="modal__label">Modo</span>
              <span class="modal__value">{{ response()!.CmpResp.CbteModo }}</span>
            </div>
            <div class="modal__field">
              <span class="modal__label">CUIT Emisor</span>
              <span class="modal__value">{{ formatCuitValue(response()!.CmpResp.CuitEmisor) }}</span>
            </div>
            <div class="modal__field">
              <span class="modal__label">Punto de Venta</span>
              <span class="modal__value">{{ response()!.CmpResp.PtoVta }}</span>
            </div>
            <div class="modal__field">
              <span class="modal__label">Tipo de Comprobante</span>
              <span class="modal__value">{{ response()!.CmpResp.CbteTipo }}</span>
            </div>
            <div class="modal__field">
              <span class="modal__label">Número de Comprobante</span>
              <span class="modal__value">{{ response()!.CmpResp.CbteNro }}</span>
            </div>
            <div class="modal__field">
              <span class="modal__label">Fecha de Emisión</span>
              <span class="modal__value">{{ formatDateValue(response()!.CmpResp.CbteFch) }}</span>
            </div>
            <div class="modal__field">
              <span class="modal__label">Importe Total</span>
              <span class="modal__value modal__value--highlight">{{ formatCurrencyValue(response()!.CmpResp.ImpTotal) }}</span>
            </div>
            <div class="modal__field">
              <span class="modal__label">Código de Autorización</span>
              <span class="modal__value modal__value--mono">{{ response()!.CmpResp.CodAutorizacion }}</span>
            </div>
            <div class="modal__field">
              <span class="modal__label">Tipo Doc. Receptor</span>
              <span class="modal__value">{{ getDocTipoLabel(response()!.CmpResp.DocTipoReceptor) }}</span>
            </div>
            <div class="modal__field">
              <span class="modal__label">CUIT/DNI Receptor</span>
              <span class="modal__value">{{ formatCuitValue(response()!.CmpResp.DocNroReceptor) }}</span>
            </div>
          </div>

          <div class="modal__divider"></div>

          <h3 class="modal__section-title">Información de Procesamiento</h3>
          <div class="modal__grid">
            <div class="modal__field">
              <span class="modal__label">Resultado</span>
              <span class="modal__value">
                <span class="modal__badge" [class]="'modal__badge--' + resultType()">
                  {{ response()!.Resultado === 'A' ? 'Aprobado' : 'Rechazado' }}
                </span>
              </span>
            </div>
            <div class="modal__field">
              <span class="modal__label">Fecha de Proceso</span>
              <span class="modal__value">{{ formatDateValue(response()!.FchProceso) }}</span>
            </div>
            <div class="modal__field">
              <span class="modal__label">Código de Evento</span>
              <span class="modal__value">{{ response()!.Events.Evt.Code }}</span>
            </div>
          </div>
        }
      </div>

      <div class="modal__footer">
        <button 
          class="modal__button"
          (click)="closeModal.emit()">
          Cerrar
        </button>
      </div>
    </div>
  </div>
}
