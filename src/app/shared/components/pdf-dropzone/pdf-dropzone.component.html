<div 
  class="dropzone"
  [class.dropzone--dragging]="isDragging()"
  [class.dropzone--has-file]="hasFile()"
  (dragover)="onDragOver($event)"
  (dragleave)="onDragLeave($event)"
  (drop)="onDrop($event)"
  role="button"
  tabindex="0"
  [attr.aria-label]="hasFile() ? 'Documento cargado: ' + fileName() : 'Zona para arrastrar archivo PDF o imagen'"
  (keydown.enter)="openFileDialog()"
  (keydown.space)="openFileDialog()">
  
  @if (!hasFile()) {
    <div class="dropzone__empty">
      <div class="dropzone__icon-wrapper">
        <svg class="dropzone__icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <polyline points="17,8 12,3 7,8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <line x1="12" y1="3" x2="12" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <h3 class="dropzone__title">Arrastra tu comprobante aqu√≠</h3>
      <p class="dropzone__subtitle">o haz clic para seleccionar un archivo PDF o imagen</p>
      @if (fileError()) {
        <div class="dropzone__error" role="alert">
          <svg class="dropzone__error-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
            <line x1="12" y1="8" x2="12" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <circle cx="12" cy="16" r="1" fill="currentColor"/>
          </svg>
          <span>{{ fileError() }}</span>
        </div>
      }
      <button 
        type="button" 
        class="dropzone__button"
        (click)="openFileDialog()">
        Seleccionar archivo
      </button>
    </div>
  } @else {
    <div class="dropzone__preview">
      <button 
        type="button"
        class="dropzone__remove-floating"
        (click)="removeFile($event)"
        aria-label="Eliminar archivo">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <div class="dropzone__viewer">
        @if (isPdf() && fileUrl()) {
          <object 
            [data]="fileUrl()" 
            type="application/pdf"
            class="dropzone__iframe"
            [attr.title]="'Vista previa del documento PDF'">
            <p class="dropzone__fallback">
              No se puede mostrar el PDF. 
              <a [href]="imageUrl()!" download="documento.pdf">Descargar PDF</a>
            </p>
          </object>
        } @else if (isImage() && imageUrl()) {
          <img 
            [src]="imageUrl()!" 
            class="dropzone__image"
            alt="Vista previa de la imagen"
            loading="lazy" />
        }
      </div>
    </div>
  }
  
  <input 
    #fileInput
    type="file" 
    class="dropzone__input"
    accept="application/pdf,image/*"
    (change)="onFileSelected($event)"
    aria-hidden="true" />
</div>
